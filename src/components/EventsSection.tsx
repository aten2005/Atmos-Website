import { useEffect, useRef } from "react"
import {gsap} from "gsap"
import {ScrollTrigger} from "gsap/ScrollTrigger"
import EventLink from "./EventLink";

gsap.registerPlugin(ScrollTrigger);

export default function EventsSection(){
	const sectionRef = useRef(null);
	const textRef = useRef(null);

useEffect(() => {
  const mm = gsap.matchMedia();

  mm.add(
    {
      // Mobile: width <= 768px
      isMobile: "(max-width: 768px)",
      // Desktop: width > 768px
      isDesktop: "(min-width: 769px)",
    },
    (context) => {
				const { isMobile, isDesktop } = context.conditions || {};

				// Pin the section
				ScrollTrigger.create({
					trigger: sectionRef.current,
					start: "top top",
					end: () => "+=" + window.innerHeight*2,
					pin: true,
					scrub: .5,
					snap: {
						snapTo: .5, // Snap to the end of the animation (progress 1)
						duration: {min: 0.5, max: 1}, // How long the snap animation takes
						ease: "power2.inOut", // Easing for the snap
						delay: 0.1, // Wait a moment before snapping
					},
				});

				if (isDesktop) {
					// Shrink SVG from right
					gsap.to(textRef.current, {
						width: "30%",
						transformOrigin: "left center", // shrink from right edge
						ease: "none",
						scrollTrigger: {
							trigger: sectionRef.current,
							start: "top top",
							end: () => "+=" + window.innerHeight/2,
							scrub: true,
						},
					});
				}

				if (isMobile) {
					gsap.to(textRef.current, {
						height: "30%",
						transformOrigin: "top center", // shrink from left edge
						ease: "none",
						scrollTrigger: {
							trigger: sectionRef.current,
							start: "top top",
							end: () => "+=" + window.innerHeight/2,
							scrub: true,
						},
					});
				}
			}
		);

  	return () => mm.revert();
	}, []);

	return (
		<div ref={sectionRef} className="h-screen w-screen relative flex flex-row bg-[#F5FF46] [background-image:linear-gradient(to_right,rgba(0,0,0,1)_5px,transparent_1px),linear-gradient(to_bottom,rgba(0,0,0,1)_5px,transparent_1px)] [background-size:5rem_5rem]">
			<svg ref={textRef} className="w-full h-full absolute top-0 left-0 z-5"
			xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1080" preserveAspectRatio="none" fill="none">
				<g clipPath="url(#clip0_248_624)">
					<rect width="1920" height="1080" fill="black"/>
					<path d="M274.925 35.1897H76.5518V71.4212H258.648V101.055H76.5518V144.926H284.081V175.601H0V4.97749H274.925V35.1897Z" fill="#F5FF46"/>
					<path d="M543.767 4.97749H625.151L497.225 175.601H423.217L296.563 4.97749H380.236L461.62 134.508L543.767 4.97749Z" fill="#F5FF46"/>
					<path d="M928.072 35.1897H729.699V71.4212H911.795V101.055H729.699V144.926H937.228V175.601H653.147V4.97749H928.072V35.1897Z" fill="#F5FF46"/>
					<path d="M976.16 4.97749H1058.31L1207.6 124.09V4.97749H1280.59V175.601H1202.25L1049.15 54.4051V175.601H976.16V4.97749Z" fill="#F5FF46"/>
					<path d="M1605.38 4.97749V35.1897H1493.22V175.601H1414.38V35.1897H1301.72V4.97749H1605.38Z" fill="#F5FF46"/>
					<path d="M1687.29 122.932C1689.67 130.727 1694.33 136.553 1701.28 140.412C1714 147.434 1735.78 150.945 1766.64 150.945C1785.12 150.945 1800.13 150.019 1811.66 148.167C1833.53 144.617 1844.47 138.019 1844.47 128.373C1844.47 122.74 1839.04 118.379 1828.19 115.293C1817.34 112.283 1800.3 109.621 1777.07 107.305L1737.39 103.254C1698.4 99.2412 1671.44 94.881 1656.52 90.1736C1631.26 82.3022 1618.62 69.9936 1618.62 53.2476C1618.62 37.9678 1630.83 25.2733 1655.25 15.164C1679.66 5.05466 1715.52 0 1762.83 0C1802.33 0 1835.99 4.78457 1863.79 14.3537C1891.77 23.8457 1906.44 37.6592 1907.79 55.7942H1832.51C1831.16 45.5305 1821.32 38.2379 1803.01 33.9164C1790.8 31.0611 1775.63 29.6334 1757.49 29.6334C1737.31 29.6334 1721.2 31.4855 1709.16 35.1897C1697.13 38.8939 1691.11 44.0643 1691.11 50.701C1691.11 56.7974 1697.04 61.3505 1708.91 64.3601C1716.54 66.3666 1732.82 68.7203 1757.74 71.4212L1822.34 78.4823C1850.65 81.5691 1872.02 85.6978 1886.43 90.8682C1908.81 98.8939 1920 110.508 1920 125.711C1920 141.299 1906.86 154.264 1880.58 164.605C1854.47 174.868 1817.51 180 1769.69 180C1720.86 180 1682.46 174.945 1654.48 164.836C1626.51 154.65 1612.52 140.682 1612.52 122.932H1687.29Z" fill="#F5FF46"/>
					<path d="M274.925 255.379H76.5518V327.842H258.648V387.109H76.5518V474.852H284.081V536.203H0V194.955H274.925V255.379Z" fill="#F5FF46"/>
					<path d="M543.767 194.955H625.151L497.225 536.203H423.217L296.563 194.955H380.236L461.62 454.016L543.767 194.955Z" fill="#F5FF46"/>
					<path d="M928.072 255.379H729.699V327.842H911.795V387.109H729.699V474.852H937.228V536.203H653.147V194.955H928.072V255.379Z" fill="#F5FF46"/>
					<path d="M976.16 194.955H1058.31L1207.6 433.18V194.955H1280.59V536.203H1202.25L1049.15 293.81V536.203H976.16V194.955Z" fill="#F5FF46"/>
					<path d="M1605.38 194.955V255.379H1493.22V536.203H1414.38V255.379H1301.72V194.955H1605.38Z" fill="#F5FF46"/>
					<path d="M1687.29 430.865C1689.67 446.453 1694.33 458.106 1701.28 465.823C1714 479.868 1735.78 486.891 1766.64 486.891C1785.12 486.891 1800.13 485.039 1811.66 481.334C1833.53 474.235 1844.47 461.039 1844.47 441.746C1844.47 430.479 1839.04 421.759 1828.19 415.585C1817.34 409.566 1800.3 404.241 1777.07 399.611L1737.39 391.508C1698.4 383.482 1671.44 374.762 1656.52 365.347C1631.26 349.604 1618.62 324.987 1618.62 291.495C1618.62 260.936 1630.83 235.547 1655.25 215.328C1679.66 195.109 1715.52 185 1762.83 185C1802.33 185 1835.99 194.569 1863.79 213.707C1891.77 232.691 1906.44 260.318 1907.79 296.588H1832.51C1831.16 276.061 1821.32 261.476 1803.01 252.833C1790.8 247.122 1775.63 244.267 1757.49 244.267C1737.31 244.267 1721.2 247.971 1709.16 255.379C1697.13 262.788 1691.11 273.129 1691.11 286.402C1691.11 298.595 1697.04 307.701 1708.91 313.72C1716.54 317.733 1732.82 322.441 1757.74 327.842L1822.34 341.965C1850.65 348.138 1872.02 356.396 1886.43 366.736C1908.81 382.788 1920 406.016 1920 436.421C1920 467.598 1906.86 493.527 1880.58 514.209C1854.47 534.736 1817.51 545 1769.69 545C1720.86 545 1682.46 534.891 1654.48 514.672C1626.51 494.299 1612.52 466.363 1612.52 430.865H1687.29Z" fill="#F5FF46"/>
					<path d="M274.925 650.569H76.5518V759.264H258.648V848.164H76.5518V979.778H284.081V1071.8H0V559.932H274.925V650.569Z" fill="#F5FF46"/>
					<path d="M543.767 559.932H625.151L497.225 1071.8H423.217L296.563 559.932H380.236L461.62 948.524L543.767 559.932Z" fill="#F5FF46"/>
					<path d="M928.072 650.569H729.699V759.264H911.795V848.164H729.699V979.778H937.228V1071.8H653.147V559.932H928.072V650.569Z" fill="#F5FF46"/>
					<path d="M976.16 559.932H1058.31L1207.6 917.27V559.932H1280.59V1071.8H1202.25L1049.15 708.215V1071.8H976.16V559.932Z" fill="#F5FF46"/>
					<path d="M1605.38 559.932V650.569H1493.22V1071.8H1414.38V650.569H1301.72V559.932H1605.38Z" fill="#F5FF46"/>
					<path d="M1687.29 913.797C1689.67 937.18 1694.33 954.659 1701.28 966.235C1714 987.302 1735.78 997.836 1766.64 997.836C1785.12 997.836 1800.13 995.058 1811.66 989.502C1833.53 978.852 1844.47 959.058 1844.47 930.119C1844.47 913.219 1839.04 900.138 1828.19 890.878C1817.34 881.849 1800.3 873.862 1777.07 866.916L1737.39 854.762C1698.4 842.724 1671.44 829.643 1656.52 815.521C1631.26 791.907 1618.62 754.981 1618.62 704.743C1618.62 658.904 1630.83 620.82 1655.25 590.492C1679.66 560.164 1715.52 545 1762.83 545C1802.33 545 1835.99 559.354 1863.79 588.061C1891.77 616.537 1906.44 657.978 1907.79 712.383H1832.51C1831.16 681.592 1821.32 659.714 1803.01 646.749C1790.8 638.183 1775.63 633.9 1757.49 633.9C1737.31 633.9 1721.2 639.457 1709.16 650.569C1697.13 661.682 1691.11 677.193 1691.11 697.103C1691.11 715.392 1697.04 729.051 1708.91 738.08C1716.54 744.1 1732.82 751.161 1757.74 759.264L1822.34 780.447C1850.65 789.707 1872.02 802.093 1886.43 817.605C1908.81 841.682 1920 876.524 1920 922.132C1920 968.897 1906.86 1007.79 1880.58 1038.81C1854.47 1069.6 1817.51 1085 1769.69 1085C1720.86 1085 1682.46 1069.84 1654.48 1039.51C1626.51 1008.95 1612.52 967.045 1612.52 913.797H1687.29Z" fill="#F5FF46"/>
				</g>
				<defs>
					<clipPath id="clip0_248_624">
						<rect width="1920" height="1080" fill="white"/>
					</clipPath>
				</defs>
			</svg>
			<div className="h-[70%] w-full mt-auto md:w-[70%] md:h-full md:ml-auto relative text-[#F5FF46] pb-24 px-12 md:p-24 flex flex-col justify-around items-center">
				<EventLink href="/" label="WORKSHOPS" className="self-start"/>
				<EventLink href="/" label="PROSHOWS" className="self-end"/>
				<EventLink href="/" label="TALKS" className="self-start"/>
				<EventLink href="/" label="COMPETITIONS" className="self-end"/>
			</div>
		</div>
	)
}